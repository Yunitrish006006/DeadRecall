# 背包存储修复 - 快速测试指南

## ⚠️ 问题
背包里面放的东西无法保存，关闭后再打开就消失了。

## ✅ 已修复
现在物品会正确保存到背包中！

---

## 🔧 修复内容

### 技术原因
之前传递的是 ItemStack 的副本，修改副本不会影响玩家手中的真实物品。

### 解决方案
改为传递玩家和手的引用，每次都获取真实的 ItemStack，确保修改会保存。

---

## 🧪 测试方法

### 方法1: 使用 IDE 构建
```
右键项目 → Build Module 'DeadRecall'
或者
Build → Build Project (Ctrl+F9)
```

### 方法2: 使用命令行构建
```powershell
# 在项目目录执行
.\gradlew build
```

### 方法3: 直接运行测试
```powershell
# 启动游戏客户端测试
.\gradlew runClient
```

---

## 🎮 游戏内测试步骤

### 1. 获取背包
- 创造模式物品栏 → 工具分类 → 背包
- 或使用指令: `/give @s deadrecall:backpack`

### 2. 测试保存功能
1. **右键点击**背包打开界面
2. **放入一些物品**（如泥土、木头、石头等）
3. **关闭背包**界面（按 ESC）
4. **再次右键**打开背包
5. **验证物品还在** ✅

### 3. 确认修复成功的标志
- ✅ 物品没有消失
- ✅ 数量正确
- ✅ 物品位置保持不变
- ✅ 多个背包各自独立保存

---

## 🔍 详细测试场景

### 场景1: 基础保存测试
```
1. 放入 10 个泥土到第一格
2. 放入 5 个木头到第二格
3. 关闭背包
4. 打开背包
预期: 10 个泥土和 5 个木头都还在 ✅
```

### 场景2: 多次开关测试
```
1. 打开背包，放入物品
2. 关闭背包
3. 重复开关 5 次
预期: 物品一直保存，不会消失 ✅
```

### 场景3: 切换物品测试
```
1. 主手持背包A，放入钻石
2. 切换到背包B，放入铁锭
3. 切回背包A
预期: 背包A 还有钻石，背包B 还有铁锭 ✅
```

### 场景4: 重启游戏测试
```
1. 放入物品到背包
2. 保存并退出游戏
3. 重新启动游戏
4. 打开背包
预期: 物品依然存在 ✅
```

---

## 📊 修复前后对比

| 操作 | 修复前 | 修复后 |
|------|--------|--------|
| 放入物品 | ✅ 可以放入 | ✅ 可以放入 |
| 关闭界面 | ❌ 物品消失 | ✅ 物品保存 |
| 再次打开 | ❌ 背包空的 | ✅ 物品还在 |
| 重启游戏 | ❌ 物品丢失 | ✅ 物品保存 |

---

## 🐛 如果仍有问题

### 检查清单
1. [ ] 确认已重新构建项目
2. [ ] 确认使用的是新版本 (1.4.1)
3. [ ] 确认背包是用右键打开的
4. [ ] 确认不是在创造模式中删除了背包

### 查看日志
如果问题依然存在，查看游戏日志:
```
run/logs/latest.log
```

查找关键词: `DeadRecall`, `Backpack`, `ERROR`

### 常见问题

**Q: 物品还是没保存？**
A: 确认你：
- 重新构建了项目
- 关闭了旧游戏重新启动
- 使用的是新的背包（旧背包可能有缓存）

**Q: 背包打不开？**
A: 检查：
- 是否用右键点击
- 是否在潜行状态（不能潜行打开）
- 背包是否在手中

**Q: 放入物品时卡住？**
A: 这是正常的，保存到 Data Components 需要一点时间

---

## ✨ 新版本特性

### v1.4.1 更新内容
- ✅ 修复背包物品无法保存的问题
- ✅ 改用动态 ItemStack 引用
- ✅ 优化存储逻辑
- ✅ 提升保存可靠性

### 技术改进
- 使用 Player + Hand 引用系统
- Data Components API 正确实现
- 实时保存，无延迟
- 完整支持主手/副手

---

## 📝 构建命令参考

```powershell
# 清理旧构建
.\gradlew clean

# 构建 JAR
.\gradlew build

# 清理并构建
.\gradlew clean build

# 启动测试客户端
.\gradlew runClient

# 查看构建输出
ls .\build\libs\
```

---

## 🎉 验证成功标准

当你完成测试后，如果满足以下条件，说明修复成功：

1. ✅ 物品放入背包后不会消失
2. ✅ 关闭再打开背包，物品还在
3. ✅ 重启游戏后，背包内容保持
4. ✅ 多个背包互不干扰
5. ✅ 主手副手都能正常使用

**恭喜！背包系统现在完全可用了！** 🎊

---

*修复版本: v1.4.1*  
*测试日期: 2026年2月15日*  
*状态: ✅ 已修复，待测试*

